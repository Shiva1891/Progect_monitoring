<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AGTEK: Project Monitoring</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>

        async function loadFromDB() {
            const res = await fetch("http://192.168.0.193:4000/projects");
            tasks = await res.json();
            refresh();
        }

        // ✅ New Project
        function newproject() {
            document.getElementById("project").classList.remove("hidden");
            document.getElementById("customername").value = "";
            document.getElementById("projectname").value = "";
            document.getElementById("parchaseqty").value = 0;
            document.getElementById("contactperson").value = "";
            document.getElementById("toDate").value = "";
            document.getElementById("newjobno").value = "";
        }

        function productionstatus() {
            document.getElementById("status").classList.remove("hidden");
        }

        function cancelproject() {
            document.getElementById("status").classList.add("hidden");
        }

        // ✅ create Project
        function createp() {
            const customername = document.getElementById("customername").value;
            const projectname = document.getElementById("projectname").value;
            const parchaseqty = document.getElementById("parchaseqty").value;
            const newjobno = document.getElementById("newjobno").value;
            const contactperson = document.getElementById("contactperson").value;
            const todate = document.getElementById("toDate").value;

            // Validate
            if (!customername) return alert("Enter Customer Name");
            if (!projectname) return alert("Enter Project Name");
            if (parchaseqty <= 0) return alert("Enter Quantity");

            const newProject = {
                jobno: newjobno,
                enquery_date: new Date().toISOString().slice(0, 10),
                project_name: projectname,
                customer: customername,
                contact_person: contactperson,
                quantity: Number(parchaseqty),
                expected_date: todate
            };

            // POST to API
            fetch("http://192.168.0.193:4000/projects", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newProject)
            })
                .then(res => res.json())
                .then(() => {
                    alert("Project Created Successfully");
                    closeup();
                    loadFromDB();
                })
        }
            


        // ✅ close Project
        function closeup() {
            document.getElementById("project").classList.add("hidden");
        }
        
        

        // ✅ Override editTask
        editTask = function (id) {
            const t = tasks.find(x => x.id === id);
            const next = prompt('Edit as JSON and press OK', JSON.stringify(t, null, 2));
            if (!next) return;
            try {
                const obj = JSON.parse(next);
                fetch(`http://192.168.0.193:4000/projects/${id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(obj)
                }).then(loadFromDB);
            } catch (e) { alert('Invalid JSON'); }
        }

        // ✅ DELETE
        async function deleteTask(id) {
            if (!confirm("Delete?")) return;
            await fetch(`http://192.168.0.193:4000/projects/${id}`, { method: "DELETE" }).then(loadFromDB);
        }

        // ✅ Load MySQL data on startup
        window.onload = loadFromDB;
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* Simple scrollbar for tables */
        .thin-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px
        }

        .thin-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 8px
        }

        .thin-scrollbar::-webkit-scrollbar-track {
            background: transparent
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-1000">
    <div class="flex max-w-10xl mx-auto">
        <!-- Side bar production and Design -->
        <div>
            <div id="sidebar" class="top-0 left-0 h-full w-[150px] bg-gray-150 text-white
                       transition-transform duration-300">
                <!-- Design -->
                <div class="p-3 text-2xl  font-semibold text-green-500">Design</div>

                <div class="p-4 space-y-2">
                    <button onclick="newproject()" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px]">
                        New   Project
                    </button>
                    <button id="allocate()" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px] h-[50px] ">
                        Allocate
                    </button>
                    <button id="dfm()" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px] h-[50px] ">
                        DFM
                    </button>
                </div>
                <!-- Production -->
                <div class="p-3 text-2xl  font-semibold text-green-500">Production</div>

                <div class="p-4 space-y-2">
                    <button id="createproject" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px] h-[50px] ">
                        Machining
                    </button>
                    <button id="createproject" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px] h-[50px] ">
                        DRO
                    </button>
                    <button id="createproject" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px] h-[50px] ">
                        Turning
                    </button>
                    <button id="createproject" class="rounded-2xl bg-green-200 p-1.5 shadow text-center text-black text-md w-[100px] h-[50px] ">
                        Others
                    </button>
                </div>
            </div>
        </div>
        <!-- Main Bar Dsahboard -->
        <div class="px-3">
            <!-- Header AGTEK -->
            <header>
                <div class="flex flex-col md:flex-row lg:flex-row md:items-start gap-4 mb-4">
                    <h1 class="text-5xl font-bold tracking-tight text-green-500">AGTEK</h1>
                    <p class="text-3xl text-left font-bold tracking-tight text-blue-500 mt-3.5">Project Monitoring Dashboard</p>
                </div>
            </header>
            <!-- Project Details --><!-- live and priority projects status -->
            <section class="flex flex-col md:flex-row md:items-start mb-2 gap-4">

                <!-- Project Details and Status-->
                    <div class="text-2xl font-bold tracking-tight mb-2 pd-1">
                        <button id="loadBtn">Live Project Details</button>
                    </div>
                    <div class="w-[450px] rounded-2xl p-1 h-[780px] overflow-y-scroll thin-scrollbar bg-gray-100 ">
                        <div>
                            <div id="priorityproject" class="bg-gray-100 p-1 grid grid gap-2"></div>
                        </div>
                        <div>
                            <div id="lineproject" class="bg-gray-100 p-1 grid grid gap-2"></div>
                        </div>
                    </div>
                <section>
                    <!-- priority projects status -->
                    <section>
                        <div class=" p-1">
                            <div class="mb-2 flex gap-4 items-end">
                                <div class="text-3xl font-bold tracking-tight px-1">Priority Project Status</div>
                                <button onclick="productionstatus()" class="rounded-2xl bg-white p-2.5 px-5 shadow gap-[100]">Change</button>
                            </div>
                        </div>
                        <div class="mt-2 px-1 overflow-y-auto max-h-[310px] thin-scrollbar bg-gray-100">
                            <div class="rounded-2xl bg-white p-4 shadow mb-2 flex gap-4">
                                <div>
                                    <div class="flex items-end gap-2">
                                        <div class="text-sm text-slate-500">Piority - 1</div>
                                    </div>
                                    <div class="flex items-end gap-2">
                                        <div id="kpiBudget" class="text-3xl font-semibold">250002J01</div>
                                    </div>
                                </div>
                                <div id="designstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Design</div>
                                <div id="draftstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Draft</div>
                                <div id="machinestatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Machine</div>
                                <div id="turningstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Turning</div>
                                <div id="anodysingstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Anodysing</div>
                                <div id="assemblystatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Assembly</div>
                                <div id="deliverystatus" class="rounded-2xl bg-red-500 p-4 shadow mb-2">Delivery</div>
                            </div>
                        </div>
                        <div id="setprioritystatus" class="grid grid gap-2"></div><!-- piority items -->
                    </section>  <!-- priority project status -->
                    <!-- Line projects status -->
                    <section>
                        <div class=" p-1">
                            <div class="mb-2 mt-2 flex gap-4 items-end">
                                <div class="text-3xl font-bold tracking-tight px-1">Line Project Status</div>
                            </div>
                        </div>
                        <div class="mt-2 overflow-y-auto max-h-[310px] thin-scrollbar bg-gray-100">
                            <div class="rounded-2xl bg-white p-4 shadow mb-2 flex gap-4">
                                <div>
                                    <div class="flex items-end gap-2">
                                        <div class="text-sm text-slate-500">Line item - 1</div>
                                    </div>
                                    <div class="flex items-end gap-2">
                                        <div id="jobno" class="text-3xl font-semibold">250003J01</div>
                                    </div>
                                </div>
                                <div id="designstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Design</div>
                                <div id="draftstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Draft</div>
                                <div id="machinestatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Machine</div>
                                <div id="turningstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Turning</div>
                                <div id="anodysingstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Anodysing</div>
                                <div id="assemblystatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Assembly</div>
                                <div id="deliverystatus" class="rounded-2xl bg-red-500 p-4 shadow mb-2">Delivery</div>
                            </div>
                            <div id="setlinestatus" class="grid grid gap-2">
                            </div>
                        </div><!-- line items -->
                    </section>  <!-- line project status -->
                </section>  <!-- line and priority status -->
            </section>  <!-- Main Window -->
            <!-- footer -->
            <footer class="text-center text-xs text-slate-400 mt-6">AGTEK dashboard • Edit in any editor • No build tools required</footer>
        </div>
    </div>
    <div id="project" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">

        <!-- Popup Box -->
        <div class="bg-white p-6 rounded-lg shadow-lg w-80 relative">
            <h2 class="text-xl font-semibold mb-2">Create Project</h2>
            <div class="p-1 bg-white">
                <label class="text-sm text-slate-500 flex flex-col">
                    Customer Name
                </label>
                <div class="flex gap-2 mb-4 ">
                    <select id="customername" class="w-[250px] shadow p-1 rounded focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option>SANMINA</option>
                        <option>SALCOMP</option>
                        <option>FUJI</option>
                        <option>FOXCONN</option>
                        <option>SFO</option>
                    </select>
                    <button onclick="customeradd()" class="bg-green-200 text-black rounded w-[50px]">
                        Add
                    </button>
                </div>
                <input id="projectname"
                       type="text"
                       placeholder="project name..."
                       class="w-[265px] p-1 shadow rounded focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4">
                <input id="contactperson"
                       type="text"
                       placeholder="Contact Person..."
                       class="w-[265px] p-1 shadow rounded focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4">
                <input id="parchaseqty"
                       type="number"
                       placeholder="Quantity..."
                       class="w-[265px] p-1 shadow rounded focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4">
                <label class="text-sm text-slate-500 flex flex-col">
                    Expected Delivery Date
                    <input id="toDate" type="date" class="rounded border-slate-300 px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-sky-400 mb-4" />
                </label>
                <input id="newjobno"
                       type="text"
                       placeholder="Job No..."
                       class="w-[265px] p-1 shadow rounded focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4">
            </div>
            <button onclick="closeup()" class="bg-red-500 text-white px-4 py-2 rounded mb-4">
                Close
            </button>

            <button onclick="createp()" class="bg-green-500 text-white px-7 py-2 rounded mb-4">
                Create
            </button>
        </div>
    </div>
    <div id="status" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">

        <!-- Popup Box -->
        <div>
            <div class="bg-white p-6 rounded-lg shadow-lg w-[500px] flex gap-4 mb-2">
                <div class="bg-white">
                    <h2 class="text-xl font-semibold mb-2">Priority Project</h2>
                    <div id="" class="p-1 bg-white">
                        250001j01
                    </div>
                    <h2 class="text-xl font-semibold mb-2">Line Project</h2>
                    <div id="" class="p-1 bg-white">
                        250002j01
                    </div>
                </div>
                <div class="items-center">
                    Live Project
                </div>
            </div>
            <button onclick="setproject()" class="bg-red-500 text-white px-4 py-2 rounded mb-4">
                Set
            </button>

            <button onclick="cancelproject()" class="bg-green-500 text-white px-7 py-2 rounded mb-4">
                Cancel
            </button>
        </div>
        
    </div>
    <script>
        function loadAPI() {
            fetch("http://192.168.0.193:4000/projects")
                .then(res => res.json())
                .then(data => {
                    const priorityproject = document.getElementById("priorityproject");
                    const lineproject = document.getElementById("lineproject");

                    priorityproject.innerHTML = "";
                    data.forEach(item => {
                        priorityproject.innerHTML +=`
                            <div class="bg-white p-5 rounded-2xl shadow-lg border border-gray-200 hover:shadow-xl transition">
                                <h2 class="text-xl font-bold text-gray-800 mb-2">${item.project_name}</h2>
                                <div class="flex gap-[70px]">
                                    <p class="text-gray-700"><b>Job No:</b> ${item.jobno}</p>
                                    <div>
                                        <p class="text-gray-700"><b>Customer:</b> ${item.customer}</p>
                                        <p class="text-gray-700"><b>Contact:</b> ${item.contact_person}</p>
                                    </div>
                                </div>
                                <div class="flex items-end md:justify-between">
                                    <p class="text-gray-700 ">Quantity:<b class="text-2xl gap-2">${item.quantity}set</b></p>
                                    <p class="text-gray-600 text-sm"><strong>Expected:</strong> ${new Date(item.expected_date).toLocaleDateString()}</p>
                                </div>
                            </div>`;
                    });
                })
                .catch(err => {
                    document.getElementById("cardContainer").innerHTML =
                        `<p class="text-red-500 font-semibold">API Error: ${err}</p>`;
                });

        }
        //select project at priority or line

        function loadprojectstatus() {
            
            fetch("http://192.168.0.193:4000/projects")
                .then(res => res.json())
                .then(data => {
                    const setprioritystatus = document.getElementById("setprioritystatus");
                    const setlinestatus = document.getElementById("setlinestatus");

                    setprioritystatus.innerHTML = "";
                    data.filter(item =>
                        item.overallstatus.toUpperCase().includes("PRIORITY")
                    ).forEach(item => {
                        setprioritystatus.innerHTML +=`
                            <div class="rounded-2xl bg-white p-4 shadow mb-2 flex gap-4">
                                <div>
                                    <div class="flex items-end gap-2">
                                        <div class="text-sm text-slate-500">Line item - 1</div>
                                    </div>
                                    <div class="flex items-end gap-2">
                                        <div id="jobno" class="text-3xl font-semibold">250003J01</div>
                                    </div>
                                </div>
                    // <div id="designstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Design</div>
                    // <div id="draftstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Draft</div>
                    // <div id="machinestatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Machine</div>
                    // <div id="turningstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Turning</div>
                    // <div id="anodysingstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Anodysing</div>
                    // <div id="assemblystatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Assembly</div>
                    // <div id="deliverystatus" class="rounded-2xl bg-red-500 p-4 shadow mb-2">Delivery</div>
                            </div>`;
                    });

                    setlinestatus.innerHTML = "";
                    data.filter(item =>
                        item.overallstatus.toUpperCase().includes("LINE")
                    ).forEach(item => {
                        setlinestatus.innerHTML +=`
                            <div class="rounded-2xl bg-white p-4 shadow mb-2 flex gap-4">
                                <div>
                                    <div class="flex items-end gap-2">
                                        <div class="text-sm text-slate-500">Line item - 1</div>
                                    </div>
                                    <div class="flex items-end gap-2">
                                        <div id="jobno" class="text-3xl font-semibold">250003J01</div>
                                    </div>
                                </div>
                    // <div id="designstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Design</div>
                    // <div id="draftstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Draft</div>
                    // <div id="machinestatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Machine</div>
                    // <div id="turningstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Turning</div>
                    // <div id="anodysingstatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Anodysing</div>
                    // <div id="assemblystatus" class="rounded-2xl bg-green-500 p-4 shadow mb-2">Assembly</div>
                    // <div id="deliverystatus" class="rounded-2xl bg-red-500 p-4 shadow mb-2">Delivery</div>
                            </div>`;
                    });
                })
                .catch(err => {
                    document.getElementById("cardContainer").innerHTML =
                        `<p class="text-red-500 font-semibold">API Error: ${err}</p>`;
                });

            document.getElementById("status").classList.add("hidden");
        }

        // setliveproject butten to assign select liveproject process
        document.getElementById("loadBtn").addEventListener("click", loadAPI);
        // setproject butten to assign select project process
        document.getElementById("setproject").addEventListener("click", loadprojectstatus);

        setInterval(loadAPI, 5000);

        loadAPI();

    </script>
</body>
</html>
